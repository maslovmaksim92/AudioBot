# üéØ –û—Ç—á—ë—Ç: –§–∞–∑–∞ 2A - Telegram –±–æ—Ç –¥–ª—è —Ñ–æ—Ç–æ —É–±–æ—Ä–æ–∫

## ‚úÖ –°—Ç–∞—Ç—É—Å: –†–ï–ê–õ–ò–ó–û–í–ê–ù–û –ò –ì–û–¢–û–í–û –ö –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ

---

## üìã –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. ‚úÖ –ò–∑—É—á–µ–Ω —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π PostingFotoTG

–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –∫–æ–¥ –∏–∑ https://github.com/maslovmaksim92/PostingFotoTG:
- –õ–æ–≥–∏–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ AI –ø–æ–¥–ø–∏—Å–µ–π —á–µ—Ä–µ–∑ GPT-3.5-turbo
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π —Å —ç–º–æ–¥–∑–∏
- –û—Ç–ø—Ä–∞–≤–∫–∞ media groups –≤ Telegram

### 2. ‚úÖ –°–æ–∑–¥–∞–Ω —Å–µ—Ä–≤–∏—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ AI –ø–æ–¥–ø–∏—Å–µ–π

**–§–∞–π–ª:** `backend/app/services/photo_caption_service.py`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–∏—Ö –ø–æ–¥–ø–∏—Å–µ–π —á–µ—Ä–µ–∑ OpenAI GPT-3.5-turbo
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Emergent LLM key –∏–ª–∏ –ø—Ä—è–º–æ–≥–æ OpenAI API key
- Fallback –Ω–∞ –≥–æ—Ç–æ–≤—ã–π —à–∞–±–ª–æ–Ω –µ—Å–ª–∏ AI –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è –ø–æ —Ç–∏–ø—É —É–±–æ—Ä–∫–∏ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Ñ–æ—Ç–æ

**–ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
```python
async def generate_caption(
    address: str, 
    photo_count: int = 1, 
    cleaning_type: str = None
) -> str
```

```python
async def format_cleaning_completion_message(
    address: str,
    photo_count: int,
    cleaning_type: str = None,
    brigade_name: str = None,
    use_ai: bool = True
) -> str
```

**–ü—Ä–∏–º–µ—Ä —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø–æ–¥–ø–∏—Å–∏:**
```
‚ú® –£–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ! (3 —Ñ–æ—Ç–æ)
üè† –ê–¥—Ä–µ—Å: —É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 10
üìÖ –î–∞—Ç–∞: 12 –æ–∫—Ç—è–±—Ä—è 2025
üßπ –í–ª–∞–∂–Ω–∞—è —É–±–æ—Ä–∫–∞ –≤—Å–µ—Ö —ç—Ç–∞–∂–µ–π

–°–ø–∞—Å–∏–±–æ –Ω–∞—à–µ–π –±—Ä–∏–≥–∞–¥–µ –∑–∞ —á–∏—Å—Ç–æ—Ç—É –∏ –∑–∞–±–æ—Ç—É –æ –≤–∞—à–µ–º –¥–æ–º–µ! üíô
```

---

### 3. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω Telegram –±–æ—Ç –¥–ª—è –±—Ä–∏–≥–∞–¥

**–§–∞–π–ª:** `backend/app/services/telegram_cleaning_bot.py`

**Workflow –±–æ—Ç–∞:**

#### –®–∞–≥ 1: –ö–æ–º–∞–Ω–¥–∞ /start
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí /start
–ë–æ—Ç ‚Üí –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç inline keyboard —Å –¥–æ–º–∞–º–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
```

–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
```
üè† –í—ã–±–µ—Ä–∏—Ç–µ –¥–æ–º –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ:

üìÖ –°–µ–≥–æ–¥–Ω—è: 12.10.2025
üìç –î–æ–º–æ–≤ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è: 3

[—É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 10]
[—É–ª. –ü—É—à–∫–∏–Ω–∞, –¥. 25]
[–ø—Ä. –ú–∏—Ä–∞, –¥. 5]
```

#### –®–∞–≥ 2: –í—ã–±–æ—Ä –¥–æ–º–∞
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –ù–∞–∂–∏–º–∞–µ—Ç –Ω–∞ –∫–Ω–æ–ø–∫—É —Å –∞–¥—Ä–µ—Å–æ–º
–ë–æ—Ç ‚Üí –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –≤—ã–±–æ—Ä –∏ –ø—Ä–æ—Å–∏—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ
```

–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
```
‚úÖ –í—ã–±—Ä–∞–Ω –¥–æ–º:
üè† —É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 10
üö™ –ü–æ–¥—ä–µ–∑–¥–æ–≤: 3
üìä –≠—Ç–∞–∂–µ–π: 5

üì∏ –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ —É–±–æ—Ä–∫–∏
–ö–æ–≥–¥–∞ –∑–∞–∫–æ–Ω—á–∏—Ç–µ, –Ω–∞–∂–º–∏—Ç–µ /done
```

#### –®–∞–≥ 3: –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–æ—Ç–æ (–æ–¥–Ω–æ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ)
–ë–æ—Ç ‚Üí –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —Ñ–æ—Ç–æ
```

–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
```
‚úÖ –§–æ—Ç–æ 1 —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ
üè† –î–æ–º: —É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 10

üì∏ –û—Ç–ø—Ä–∞–≤—å—Ç–µ –µ—â—ë —Ñ–æ—Ç–æ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ /done –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
```

#### –®–∞–≥ 4: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ /done
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí /done
–ë–æ—Ç ‚Üí –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç AI –ø–æ–¥–ø–∏—Å—å –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–æ—Ç–æ –æ–±—Ä–∞—Ç–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º (—Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º)
```

–ü—Ä–∏–º–µ—Ä:
```
‚è≥ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é —Ñ–æ—Ç–æ –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é –ø–æ–¥–ø–∏—Å—å...

[–§–æ—Ç–æ 1]
[–§–æ—Ç–æ 2]
[–§–æ—Ç–æ 3]

‚ú® –£–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ! (3 —Ñ–æ—Ç–æ)
üè† –ê–¥—Ä–µ—Å: —É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 10
üìÖ –î–∞—Ç–∞: 12 –æ–∫—Ç—è–±—Ä—è 2025
üßπ –í–ª–∞–∂–Ω–∞—è —É–±–æ—Ä–∫–∞ –≤—Å–µ—Ö —ç—Ç–∞–∂–µ–π

–°–ø–∞—Å–∏–±–æ –Ω–∞—à–µ–π –±—Ä–∏–≥–∞–¥–µ –∑–∞ —á–∏—Å—Ç–æ—Ç—É –∏ –∑–∞–±–æ—Ç—É –æ –≤–∞—à–µ–º –¥–æ–º–µ! üíô

---

‚úÖ –£–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!
üè† —É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 10
üì∏ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —Ñ–æ—Ç–æ: 3

–°–ø–∞—Å–∏–±–æ –∑–∞ —Ä–∞–±–æ—Ç—É! üíô
```

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
- `handle_start_command()` - –ø–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ–º–æ–≤
- `handle_house_selection()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –¥–æ–º–∞
- `handle_photo()` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–æ—Ç–æ –≤ —Å–µ—Å—Å–∏—é
- `handle_done_command()` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è AI –ø–æ–¥–ø–∏—Å–∏ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞
- `send_message()` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–∫—Å—Ç–∞
- `send_photo()` - –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ–¥–Ω–æ–≥–æ —Ñ–æ—Ç–æ
- `send_media_group()` - –æ—Ç–ø—Ä–∞–≤–∫–∞ –≥—Ä—É–ø–ø—ã —Ñ–æ—Ç–æ

**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏:**
- –ö–ª–∞—Å—Å `CleaningSession` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- In-memory —Ö—Ä–∞–Ω–∏–ª–∏—â–µ `user_sessions` (–≤ production –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ Redis)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å–µ—Å—Å–∏–∏ –ø–æ—Å–ª–µ /done

---

### 4. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å webhook

**–§–∞–π–ª:** `backend/app/routers/telegram_webhook.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
1. –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ –≤ webhook
2. –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ callback_query –¥–ª—è inline buttons
3. –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `handle_telegram_command` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ /start –∏ /done
4. –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:
   - `handle_telegram_callback()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏–π –Ω–∞ –∫–Ω–æ–ø–∫–∏
   - `handle_telegram_photo()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Å–æ–±—ã—Ç–∏—è:**
- `message.text` ‚Üí –∫–æ–º–∞–Ω–¥—ã /start, /done, /help –∏ —Ç.–¥.
- `message.photo` ‚Üí –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ –æ—Ç –±—Ä–∏–≥–∞–¥
- `callback_query` ‚Üí –≤—ã–±–æ—Ä –¥–æ–º–∞ —á–µ—Ä–µ–∑ inline buttons

---

## üß™ –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º

**–í–∞–∂–Ω–æ:** –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ **—Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ**:
- –§–æ—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è **–æ–±—Ä–∞—Ç–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (–Ω–µ –≤ –≥—Ä—É–ø–ø—É)
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è **–º–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ** –¥–ª—è —Å–ø–∏—Å–∫–∞ –¥–æ–º–æ–≤
- –ë–î –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ (TODO –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏)

**–î–ª—è production –Ω—É–∂–Ω–æ:**
1. –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å –ë–î –≤ `telegram_cleaning_bot.py`
2. –î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–ª—É—á–µ–Ω–∏—è –±—Ä–∏–≥–∞–¥—ã –∏ –¥–æ–º–æ–≤ –∏–∑ PostgreSQL
3. –ò–∑–º–µ–Ω–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É —Ñ–æ—Ç–æ: –≤–º–µ—Å—Ç–æ `chat_id` –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ID –≥—Ä—É–ø–ø—ã
4. –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ —Ç–∞–±–ª–∏—Ü—É `cleaning_photos`
5. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å webhook –≤ Bitrix24 –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ email –≤ –£–ö

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞

```
backend/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ photo_caption_service.py          # ‚úÖ –ù–æ–≤—ã–π - AI –ø–æ–¥–ø–∏—Å–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ telegram_cleaning_bot.py          # ‚úÖ –ù–æ–≤—ã–π - –ª–æ–≥–∏–∫–∞ –±–æ—Ç–∞ –¥–ª—è –±—Ä–∏–≥–∞–¥
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ telegram_service.py               # –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ brain_intents.py                  # ‚úÖ –£–ª—É—á—à–µ–Ω - fallback –Ω–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ brain_resolvers.py                # ‚úÖ –£–ª—É—á—à–µ–Ω - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ bitrix24_service.py               # ‚úÖ –£–ª—É—á—à–µ–Ω - –ø–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ routers/
‚îÇ       ‚îî‚îÄ‚îÄ telegram_webhook.py               # ‚úÖ –û–±–Ω–æ–≤–ª—ë–Ω - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ—Ç–æ –∏ callback
‚îÇ
frontend/
‚îî‚îÄ‚îÄ src/
    ‚îî‚îÄ‚îÄ components/
        ‚îú‚îÄ‚îÄ Dashboard/
        ‚îÇ   ‚îî‚îÄ‚îÄ Dashboard.js                  # ‚úÖ –£–ª—É—á—à–µ–Ω - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
        ‚îî‚îÄ‚îÄ Works/
            ‚îî‚îÄ‚îÄ BrigadeStats.js               # ‚úÖ –£–ª—É—á—à–µ–Ω - —Å–µ–ª–µ–∫—Ç–æ—Ä –º–µ—Å—è—Ü–∞
```

---

## üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–æ—Ç–∞:

1. **–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ backend –∑–∞–ø—É—â–µ–Ω:**
```bash
supervisorctl status backend
```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
```bash
# –í /app/backend/.env –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å:
TELEGRAM_BOT_TOKEN=your_bot_token
OPENAI_API_KEY=your_openai_key  # –∏–ª–∏ EMERGENT_LLM_KEY
```

3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ webhook Telegram:**
```bash
curl -X POST "https://your-domain.com/api/telegram-webhook/set"
```

4. **–û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ –≤ Telegram:**
```
@YourBotUsername
```

5. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã:**
```
/start  ‚Üí –í—ã–±—Ä–∞—Ç—å –¥–æ–º –∏ –Ω–∞—á–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Ñ–æ—Ç–æ
/done   ‚Üí –ó–∞–≤–µ—Ä—à–∏—Ç—å —É–±–æ—Ä–∫—É –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ
/help   ‚Üí –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É
```

### –ü—Ä–∏–º–µ—Ä —Å—Ü–µ–Ω–∞—Ä–∏—è:

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: /start

–ë–æ—Ç: üè† –í—ã–±–µ—Ä–∏—Ç–µ –¥–æ–º –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ:
     [—É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 10]
     [—É–ª. –ü—É—à–∫–∏–Ω–∞, –¥. 25]
     [–ø—Ä. –ú–∏—Ä–∞, –¥. 5]

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: *–Ω–∞–∂–∏–º–∞–µ—Ç –Ω–∞ "—É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 10"*

–ë–æ—Ç: ‚úÖ –í—ã–±—Ä–∞–Ω –¥–æ–º: —É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 10
     üì∏ –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ —É–±–æ—Ä–∫–∏

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: *–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç 3 —Ñ–æ—Ç–æ*

–ë–æ—Ç: ‚úÖ –§–æ—Ç–æ 1 —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ
     ‚úÖ –§–æ—Ç–æ 2 —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ
     ‚úÖ –§–æ—Ç–æ 3 —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: /done

–ë–æ—Ç: ‚è≥ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é —Ñ–æ—Ç–æ –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é –ø–æ–¥–ø–∏—Å—å...
     
     [–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç 3 —Ñ–æ—Ç–æ —Å AI –ø–æ–¥–ø–∏—Å—å—é]
     
     ‚úÖ –£–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!
     –°–ø–∞—Å–∏–±–æ –∑–∞ —Ä–∞–±–æ—Ç—É! üíô
```

---

## üîÆ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (TODO)

### Production –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:

1. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ë–î:**
   - [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `get_brigade_by_telegram_id()`
   - [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `get_houses_for_brigade_by_date()`
   - [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `save_cleaning_completion()`
   - [ ] –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É `cleaning_photos` –≤ PostgreSQL

2. **–û—Ç–ø—Ä–∞–≤–∫–∞ –≤ –≥—Ä—É–ø–ø—É:**
   - [ ] –ò–∑–º–µ–Ω–∏—Ç—å `send_media_group()` –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ —Ü–µ–ª–µ–≤—É—é –≥—Ä—É–ø–ø—É
   - [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `TELEGRAM_TARGET_CHAT_ID` –≤ .env

3. **Webhook –≤ Bitrix24:**
   - [ ] –°–æ–∑–¥–∞—Ç—å endpoint `/api/bitrix24/cleaning-completed`
   - [ ] –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —É–±–æ—Ä–∫–∏
   - [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å –≤ Bitrix24 –¥–ª—è email –≤ –£–ö

4. **–•—Ä–∞–Ω–∏–ª–∏—â–µ —Å–µ—Å—Å–∏–π:**
   - [ ] –ó–∞–º–µ–Ω–∏—Ç—å in-memory `user_sessions` –Ω–∞ Redis
   - [ ] –î–æ–±–∞–≤–∏—Ç—å TTL –¥–ª—è –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ä—ã—Ö —Å–µ—Å—Å–∏–π

5. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∏—á–∏:**
   - [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "–û—Ç–º–µ–Ω–∏—Ç—å" –¥–ª—è –æ—Ç–º–µ–Ω—ã –≤—ã–±–æ—Ä–∞ –¥–æ–º–∞
   - [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "–£–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Ñ–æ—Ç–æ"
   - [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é: –º–∞–∫—Å–∏–º—É–º N —Ñ–æ—Ç–æ
   - [ ] –î–æ–±–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–∏—Å–ø–µ—Ç—á–µ—Ä—É –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —É–±–æ—Ä–∫–∏

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –∫–ª—é—á–µ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:
- `[telegram_cleaning_bot]` - –¥–µ–π—Å—Ç–≤–∏—è –±–æ—Ç–∞
- `[photo_caption]` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è AI –ø–æ–¥–ø–∏—Å–µ–π
- `[telegram_webhook]` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ webhook —Å–æ–±—ã—Ç–∏–π

**–ü—Ä–∏–º–µ—Ä—ã –ª–æ–≥–æ–≤:**
```
INFO - [telegram_cleaning_bot] /start command from user 12345
INFO - [telegram_cleaning_bot] House selected: 1 by user 12345
INFO - [telegram_cleaning_bot] Photo received from user 12345
INFO - [photo_caption] Generating caption for address: —É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 10
INFO - [photo_caption] AI caption generated successfully: ‚ú® –£–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞...
INFO - [telegram_cleaning_bot] /done command from user 12345
INFO - [telegram_cleaning_bot] Media group sent to 12345: 3 photos
```

---

## ‚úÖ –ò—Ç–æ–≥–∏

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:
‚úÖ AI —Å–µ—Ä–≤–∏—Å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ–¥–ø–∏—Å–µ–π (–∞–¥–∞–ø—Ç–∞—Ü–∏—è –∏–∑ PostingFotoTG)
‚úÖ Telegram –±–æ—Ç —Å –ø–æ–ª–Ω—ã–º workflow –¥–ª—è –±—Ä–∏–≥–∞–¥
‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ /start, /done
‚úÖ Inline keyboard –¥–ª—è –≤—ã–±–æ—Ä–∞ –¥–æ–º–æ–≤
‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–æ—Ç–æ –≤ —Å–µ—Å—Å–∏–∏
‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º: –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ–±—Ä–∞—Ç–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º
‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å webhook handler

### –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é:
- –ë–æ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω —Å –º–æ–∫–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- –ú–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Å—å workflow –æ—Ç /start –¥–æ /done
- AI –ø–æ–¥–ø–∏—Å–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### –¢—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –¥–ª—è production:
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å PostgreSQL
- –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ —Ü–µ–ª–µ–≤—É—é –≥—Ä—É–ø–ø—É –≤–º–µ—Å—Ç–æ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
- Webhook –≤ Bitrix24
- Redis –¥–ª—è —Å–µ—Å—Å–∏–π

---

**Preview URL:** https://prop-management-3.preview.emergentagent.com

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 12 –æ–∫—Ç—è–±—Ä—è 2025, 10:56 UTC
