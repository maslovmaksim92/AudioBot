# ‚úÖ Telegram –ë–æ—Ç –¥–ª—è –ë—Ä–∏–≥–∞–¥ - –ì–æ—Ç–æ–≤ –∫ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

## üì± –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ

**Username:** @aitest123432_bot  
**ID:** 8327964029  
**Webhook:** ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç  
**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∞ (499 –¥–æ–º–æ–≤)

---

## üöÄ –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–æ—Ç–∞

### –®–∞–≥ 1: –û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ –≤ Telegram
1. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram
2. –ù–∞–π–¥–∏—Ç–µ –±–æ—Ç–∞: **@aitest123432_bot**
3. –ù–∞–∂–º–∏—Ç–µ "Start" –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/start`

### –®–∞–≥ 2: –í—ã–±–µ—Ä–∏—Ç–µ –¥–æ–º
–ü–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã `/start` –±–æ—Ç –ø–æ–∫–∞–∂–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ–º–æ–≤ –¥–ª—è —É–±–æ—Ä–∫–∏ (5 —Å–ª—É—á–∞–π–Ω—ã—Ö –∞–¥—Ä–µ—Å–æ–≤ –∏–∑ –ë–î):
```
üè† –í—ã–±–µ—Ä–∏—Ç–µ –¥–æ–º –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ:

üìÖ –°–µ–≥–æ–¥–Ω—è: 12.10.2025
üìç –î–æ–º–æ–≤ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è: 5
```

–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –ª—é–±–æ–π –∞–¥—Ä–µ—Å –∏–∑ —Å–ø–∏—Å–∫–∞ –∫–Ω–æ–ø–æ–∫.

### –®–∞–≥ 3: –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ
–ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –¥–æ–º–∞ –±–æ—Ç –æ—Ç–≤–µ—Ç–∏—Ç:
```
‚úÖ –í—ã–±—Ä–∞–Ω –¥–æ–º:
üè† [–∞–¥—Ä–µ—Å]
üö™ –ü–æ–¥—ä–µ–∑–¥–æ–≤: X
üìä –≠—Ç–∞–∂–µ–π: Y

üì∏ –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ —É–±–æ—Ä–∫–∏
–ö–æ–≥–¥–∞ –∑–∞–∫–æ–Ω—á–∏—Ç–µ, –Ω–∞–∂–º–∏—Ç–µ /done
```

–û—Ç–ø—Ä–∞–≤—å—Ç–µ 1 –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–æ—Ç–æ.

–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ñ–æ—Ç–æ –±–æ—Ç –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç:
```
‚úÖ –§–æ—Ç–æ 1 —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ
üè† –î–æ–º: [–∞–¥—Ä–µ—Å]

üì∏ –û—Ç–ø—Ä–∞–≤—å—Ç–µ –µ—â—ë —Ñ–æ—Ç–æ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ /done –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
```

### –®–∞–≥ 4: –ó–∞–≤–µ—Ä—à–∏—Ç–µ —É–±–æ—Ä–∫—É
–û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/done`

–ë–æ—Ç:
1. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç AI –ø–æ–¥–ø–∏—Å—å (GPT-4o-mini)
2. –û—Ç–ø—Ä–∞–≤–∏—Ç —Ñ–æ—Ç–æ –æ–±—Ä–∞—Ç–Ω–æ —Å –ø–æ–¥–ø–∏—Å—å—é –≤ —Ñ–æ—Ä–º–∞—Ç–µ:

```
üßπ –£–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
üè† –ê–¥—Ä–µ—Å: [–ø–æ–ª–Ω—ã–π –∞–¥—Ä–µ—Å]
üìÖ –î–∞—Ç–∞: 12 –æ–∫—Ç—è–±—Ä—è 2025
üë∑ –ë—Ä–∏–≥–∞–¥–∞: #1

üåü [–ú–æ—Ç–∏–≤–∏—Ä—É—é—â–∏–π —Ç–µ–∫—Å—Ç –æ—Ç AI]

#–ß–∏—Å—Ç–æ—Ç–∞ #–ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å #–°–æ—Ü–∏–∞–ª—å–Ω–∞—è–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å #–ö–∞–ª—É–≥–∞
```

3. –¢–∞–∫–∂–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç —Ñ–æ—Ç–æ –≤ –≥—Ä—É–ø–ø—É (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω `TELEGRAM_TARGET_CHAT_ID=-1002384210149`)
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ –≤ –ë–î (—Ç–∞–±–ª–∏—Ü–∞ `cleaning_photos`)

---

## üîß –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)
- ‚úÖ `TELEGRAM_BOT_TOKEN` - –æ–±–Ω–æ–≤–ª–µ–Ω
- ‚úÖ `TELEGRAM_TARGET_CHAT_ID` - –≥—Ä—É–ø–ø–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ç–æ
- ‚ö†Ô∏è `OPENAI_API_KEY` - –≤–æ–∑–º–æ–∂–Ω–æ –Ω–µ–ø–æ–ª–Ω—ã–π (–±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω fallback —Ç–µ–∫—Å—Ç)

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ PostgreSQL –ø–æ–¥–∫–ª—é—á–µ–Ω–∞
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `houses` - 499 –¥–æ–º–æ–≤
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `cleaning_photos` - —Å–æ–∑–¥–∞–Ω–∞
- ‚ö†Ô∏è –ü–æ–ª–µ `brigade_number` = NULL –¥–ª—è –≤—Å–µ—Ö –¥–æ–º–æ–≤ (–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è mock –¥–∞–Ω–Ω—ã–µ)

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ö–æ–º–∞–Ω–¥–∞ `/start` - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 5 —Å–ª—É—á–∞–π–Ω—ã—Ö –¥–æ–º–æ–≤ –∏–∑ –ë–î
- ‚úÖ –í—ã–±–æ—Ä –¥–æ–º–∞ —á–µ—Ä–µ–∑ inline buttons
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ (–ª—é–±–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ)
- ‚úÖ –ö–æ–º–∞–Ω–¥–∞ `/done` - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å AI –ø–æ–¥–ø–∏—Å—å—é
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ –≥—Ä—É–ø–ø—É Telegram
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î

---

## üìä –§–æ—Ä–º–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (–∫–∞–∫ –≤ –ø—Ä–∏–º–µ—Ä–µ)

–ü—Ä–∏–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä–æ–µ –≤–µ—Ä–Ω–µ—Ç –±–æ—Ç:

```
üßπ –£–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
üè† –ê–¥—Ä–µ—Å: —É–ª–∏—Ü–∞ –õ–µ–Ω–∏–Ω–∞ 42, 248016 –ö–∞–ª—É–≥–∞ –ö–∞–ª—É–∂—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å, –†–æ—Å—Å–∏—è
üìÖ –î–∞—Ç–∞: 12 –æ–∫—Ç—è–±—Ä—è 2025
üë∑ –ë—Ä–∏–≥–∞–¥–∞: #1

üåü –í–µ–ª–∏–∫–æ–ª–µ–ø–Ω–∞—è —Ä–∞–±–æ—Ç–∞, —É–±–æ—Ä—â–∏–∫–∏! –ù–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞ –ø–æ–±–ª–∞–≥–æ–¥–∞—Ä–∏—Ç –≤–∞—Å –∑–∞ —É—Å–µ—Ä–¥–∏–µ –∏ –ø—Ä–µ–¥–∞–Ω–Ω–æ—Å—Ç—å –¥–µ–ª—É —á–∏—Å—Ç–æ—Ç—ã. –°–ø–∞—Å–∏–±–æ, —á—Ç–æ –¥–µ–ª–∞–µ—Ç–µ –Ω–∞—à –º–∏—Ä —è—Ä—á–µ –∏ —á–∏—â–µ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å. –í–∞—à —Ç—Ä—É–¥ –Ω–µ —Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞–µ—Ç –±–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω—É—é –æ–±—Å—Ç–∞–Ω–æ–≤–∫—É, –Ω–æ –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —á–∏—Å—Ç–æ—Ç—É –∏ –ø–æ—Ä—è–¥–æ–∫ –≤ –Ω–∞—à–µ–º –¥–æ–º–µ. –°—Ç—Ä–µ–º–∏—Ç–µ—Å—å –∫ —Å–≤–æ–∏–º —Ü–µ–ª—è–º, –∏ –≤–º–µ—Å—Ç–µ –º—ã —Å–¥–µ–ª–∞–µ–º –Ω–∞—à–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ –ª—É—á—à–µ! üí™üåüüåø

#–ß–∏—Å—Ç–æ—Ç–∞ #–ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å #–°–æ—Ü–∏–∞–ª—å–Ω–∞—è–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å #–ö–∞–ª—É–≥–∞
```

---

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (TODO)

1. **brigade_number –≤ –ë–î = NULL** - –≤—Å–µ 499 –¥–æ–º–æ–≤ –Ω–µ –∏–º–µ—é—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–π –±—Ä–∏–≥–∞–¥—ã
   - –ü—Ä–∏—á–∏–Ω–∞: Bitrix24 –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ –±—Ä–∏–≥–∞–¥–∞—Ö –∏–ª–∏ –ª–æ–≥–∏–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
   - –†–µ—à–µ–Ω–∏–µ: –ù—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å `bitrix24_service._prefer_brigade_from_text()`
   - –í—Ä–µ–º–µ–Ω–Ω–æ: –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è mock –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–µ–º–æ

2. **–î–∞—Ç—ã —É–±–æ—Ä–æ–∫ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã**
   - –í –ë–î `cleaning_schedule` = `{}` (–ø—É—Å—Ç–æ–π)
   - –ë–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–µ –¥–æ–º–∞, –∞ –Ω–µ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é –Ω–∞ 13.10.2025

3. **OPENAI_API_KEY –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–ø–æ–ª–Ω—ã–º**
   - –ï—Å–ª–∏ AI –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω fallback —Ç–µ–∫—Å—Ç

---

## üîÑ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–æ—Ç–∞
1. –û—Ç–∫—Ä–æ–π—Ç–µ @aitest123432_bot
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª–Ω—ã–π flow: /start ‚Üí –≤—ã–±–æ—Ä –¥–æ–º–∞ ‚Üí —Ñ–æ—Ç–æ ‚Üí /done
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
   - ‚úÖ –°–ø–∏—Å–æ–∫ –¥–æ–º–æ–≤ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
   - ‚úÖ –§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
   - ‚úÖ –ü–æ–¥–ø–∏—Å—å –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è
   - ‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç –æ–±—Ä–∞—Ç–Ω–æ

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –±—Ä–∏–≥–∞–¥ –∏–∑ Bitrix24
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª–µ `assigned_by_name` –≤ Bitrix24
- –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –≤ `_parse_brigade_number()`
- –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —É–±–æ—Ä–æ–∫
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å `cleaning_schedule` –∏–∑ Bitrix24
- –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –¥–æ–º–∞ –ø–æ –¥–∞—Ç–µ (13.10.2025 –¥–ª—è –±—Ä–∏–≥–∞–¥—ã 1)

---

## üìû –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### API Endpoints
- `POST /api/telegram-webhook/` - webhook –¥–ª—è Telegram
- `POST /api/telegram-webhook/set-webhook` - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å webhook
- `GET /api/telegram-webhook/webhook-info` - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å webhook

### –õ–æ–≥–∏
```bash
# Backend –ª–æ–≥–∏
tail -f /var/log/supervisor/backend.err.log | grep telegram

# –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫
grep "telegram_cleaning_bot" /var/log/supervisor/backend.err.log
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–æ—Ç–æ
SELECT * FROM cleaning_photos ORDER BY created_at DESC LIMIT 10;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ–º–∞
SELECT id, address, brigade_number FROM houses LIMIT 10;
```

---

## ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç—É!

–ë–æ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤. –û—Ç–∫—Ä–æ–π—Ç–µ @aitest123432_bot –∏ –Ω–∞—á–Ω–∏—Ç–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ! üöÄ
