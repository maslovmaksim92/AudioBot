# üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Bitrix24 –¥–ª—è AudioBot

## üìã –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### 1.1 –ü–µ—Ä–µ—Ö–æ–¥ –≤ —Ä–∞–∑–¥–µ–ª —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à –ø–æ—Ä—Ç–∞–ª: https://vas-dom.bitrix24.ru
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è** ‚Üí **–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º** ‚Üí **–î—Ä—É–≥–∏–µ** ‚Üí **–õ–æ–∫–∞–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**
3. –ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é: `https://vas-dom.bitrix24.ru/devops/section/developer/`

### 1.2 –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
1. –ù–∞–∂–º–∏—Ç–µ **"–°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"**
2. –í—ã–±–µ—Ä–∏—Ç–µ **"–õ–æ–∫–∞–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"**
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:

```
–ù–∞–∑–≤–∞–Ω–∏–µ: AudioBot Integration
–ö–æ–¥: audiobot
–û–ø–∏—Å–∞–Ω–∏–µ: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ–º–∞–º–∏ AudioBot
URL –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: https://audiobot-qci2.onrender.com
```

## üîê –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ (–ö–†–ò–¢–ò–ß–ù–û!)

### 2.1 –ü—Ä–∞–≤–∞ CRM (–æ—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
‚úÖ –û—Ç–º–µ—Ç—å—Ç–µ –í–°–ï –ø—Ä–∞–≤–∞ CRM:
- **crm** - –î–æ—Å—Ç—É–ø –∫ CRM
- **crm.lead.read** - –ß—Ç–µ–Ω–∏–µ –ª–∏–¥–æ–≤
- **crm.lead.write** - –ó–∞–ø–∏—Å—å –ª–∏–¥–æ–≤  
- **crm.deal.read** - –ß—Ç–µ–Ω–∏–µ —Å–¥–µ–ª–æ–∫
- **crm.deal.write** - –ó–∞–ø–∏—Å—å —Å–¥–µ–ª–æ–∫
- **crm.contact.read** - –ß—Ç–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
- **crm.contact.write** - –ó–∞–ø–∏—Å—å –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
- **crm.company.read** - –ß—Ç–µ–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–π
- **crm.company.write** - –ó–∞–ø–∏—Å—å –∫–æ–º–ø–∞–Ω–∏–π

### 2.2 –ü—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
‚úÖ –û—Ç–º–µ—Ç—å—Ç–µ:
- **user** - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö
- **department** - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è—Ö
- **user.basic** - –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö

### 2.3 –ü—Ä–∞–≤–∞ –∑–∞–¥–∞—á –∏ –ø—Ä–æ–µ–∫—Ç–æ–≤
‚úÖ –û—Ç–º–µ—Ç—å—Ç–µ:
- **task** - –î–æ—Å—Ç—É–ø –∫ –∑–∞–¥–∞—á–∞–º
- **tasks** - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏

### 2.4 –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ (–¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞)
‚úÖ –û—Ç–º–µ—Ç—å—Ç–µ –í–°–ï –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø—Ä–∞–≤–∞:
- **calendar** - –ö–∞–ª–µ–Ω–¥–∞—Ä—å
- **log** - –ñ–∏–≤–∞—è –ª–µ–Ω—Ç–∞
- **sonet_group** - –ì—Ä—É–ø–ø—ã –∏ –ø—Ä–æ–µ–∫—Ç—ã
- **lists** - –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ —Å–ø–∏—Å–∫–∏
- **disk** - –î–∏—Å–∫
- **im** - –ß–∞—Ç –∏ –∑–≤–æ–Ω–∫–∏

## üöÄ –®–∞–≥ 3: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### 3.1 –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
1. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ —Å–ø–∏—Å–∫–µ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
2. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–µ–≥–æ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
3. **–í–ê–ñ–ù–û**: –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:

```
APPLICATION_ID: [–Ω–∞–π–¥–µ—Ç–µ –≤ URL –∏–ª–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö]
APPLICATION_SECRET: [–±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏]
MEMBER_ID: [–≤–∞—à ID –ø–æ—Ä—Ç–∞–ª–∞]
```

### 3.2 –ü–æ–ª—É—á–µ–Ω–∏–µ Webhook URL
1. –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞–π–¥–∏—Ç–µ —Ä–∞–∑–¥–µ–ª **"–í—Ö–æ–¥—è—â–∏–π –≤–µ–±—Ö—É–∫"**
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **–ø–æ–ª–Ω—ã–π URL webhook**
3. –û–Ω –±—É–¥–µ—Ç –∏–º–µ—Ç—å –≤–∏–¥: `https://vas-dom.bitrix24.ru/rest/[USER_ID]/[WEBHOOK_TOKEN]/`

## ‚öôÔ∏è –®–∞–≥ 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ AudioBot

### 4.1 –û–±–Ω–æ–≤–∏—Ç–µ —Ñ–∞–π–ª .env –≤ backend
```env
# Bitrix24 Configuration
BITRIX_WEBHOOK_URL=https://vas-dom.bitrix24.ru/rest/[USER_ID]/[WEBHOOK_TOKEN]/
BITRIX_PORTAL_URL=https://vas-dom.bitrix24.ru
BITRIX_APPLICATION_ID=[APPLICATION_ID]
BITRIX_APPLICATION_SECRET=[APPLICATION_SECRET]
BITRIX_MEMBER_ID=[MEMBER_ID]
```

### 4.2 –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
# –í –≤–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
sudo supervisorctl restart backend
sudo supervisorctl restart frontend
```

## üß™ –®–∞–≥ 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### 5.1 –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook
```bash
# –¢–µ—Å—Ç –±–∞–∑–æ–≤–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
curl "https://vas-dom.bitrix24.ru/rest/[USER_ID]/[WEBHOOK_TOKEN]/crm.deal.list?select[]=ID&select[]=TITLE"
```

### 5.2 –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ AudioBot API
```bash
# –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–º–æ–≤
curl "https://audiobot-qci2.onrender.com/api/cleaning/houses"

# –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤  
curl "https://audiobot-qci2.onrender.com/api/dashboard/employees"
```

## ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1: "insufficient_scope"
**–†–µ—à–µ–Ω–∏–µ**: –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—ã–±—Ä–∞–Ω—ã –í–°–ï –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø—Ä–∞–≤–∞ –≤ –®–∞–≥–µ 2

### –ü—Ä–æ–±–ª–µ–º–∞ 2: "authorization_error" 
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å WEBHOOK_TOKEN –≤ .env —Ñ–∞–π–ª–µ

### –ü—Ä–æ–±–ª–µ–º–∞ 3: "portal_deleted" –∏–ª–∏ "user_not_found"
**–†–µ—à–µ–Ω–∏–µ**: –ü–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –ø—Ä–∞–≤–∞–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –≤–∏–¥–Ω–æ –≤ —Å–ø–∏—Å–∫–µ
**–†–µ—à–µ–Ω–∏–µ**: 
1. –û—á–∏—Å—Ç–∏—Ç–µ –∫–µ—à –±—Ä–∞—É–∑–µ—Ä–∞
2. –ó–∞–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ —Ä–µ–∂–∏–º –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã —Å–ª—É–∂–±—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏
–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –ø—Ä–æ–±–ª–µ–º—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `/var/log/supervisor/backend.*.log`
2. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É Bitrix24 —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —á—Ç–æ —Å–æ–∑–¥–∞–µ—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —É –≤–∞—Å –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –ø–æ—Ä—Ç–∞–ª–∞

---

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç
–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤ –≤–∞—à AudioBot –ø–æ–ª—É—á–∏—Ç:
- ‚úÖ –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ CRM –¥–∞–Ω–Ω—ã–º (490 –¥–æ–º–æ–≤)
- ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞—Ö (82 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞, 6 –±—Ä–∏–≥–∞–¥)  
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ –æ–±–Ω–æ–≤–ª—è—Ç—å –∑–∞–¥–∞—á–∏
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å –∫–∞–ª–µ–Ω–¥–∞—Ä–µ–º –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–æ–º
- ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—à–∏–±–æ–∫ 401 Unauthorized

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: 10-15 –º–∏–Ω—É—Ç
**–°–ª–æ–∂–Ω–æ—Å—Ç—å**: –ù–∏–∑–∫–∞—è (–ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞)